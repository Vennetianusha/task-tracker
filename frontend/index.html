<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Task Tracker</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { padding-top: 30px; }
    .completed { text-decoration: line-through; opacity: 0.7; }
  </style>
</head>
<body>
  <div class="container">
    <h2 class="mb-4">Task Tracker</h2>

    <div class="row mb-3">
      <div class="col-md-5 mb-2">
        <input id="title" class="form-control" placeholder="Task title" />
      </div>
      <div class="col-md-5 mb-2">
        <input id="description" class="form-control" placeholder="Description (optional)" />
      </div>
      <div class="col-md-2 mb-2">
        <button id="addBtn" class="btn btn-primary w-100">Add Task</button>
      </div>
    </div>

    <ul id="tasksList" class="list-group"></ul>
  </div>

  <script>
    // API base URL - backend must be running on this address
    const API = 'http://localhost:3000/tasks';

    // Helper to fetch and render tasks
    async function fetchTasks() {
      try {
        const res = await fetch(API);
        const tasks = await res.json();
        const list = document.getElementById('tasksList');
        list.innerHTML = '';

        if (!tasks || tasks.length === 0) {
          list.innerHTML = '<li class="list-group-item">No tasks yet.</li>';
          return;
        }

        tasks.forEach(t => {
          const li = document.createElement('li');
          li.className = 'list-group-item d-flex justify-content-between align-items-start';

          const left = document.createElement('div');
          left.innerHTML = `<div class="${t.status === 'Completed' ? 'completed' : ''}">
                              <strong>${escapeHtml(t.title)}</strong><br>
                              <small>${escapeHtml(t.description || '')}</small>
                            </div>
                            <div><small>Status: ${t.status}</small></div>`;

          const right = document.createElement('div');

          const completeBtn = document.createElement('button');
          completeBtn.className = 'btn btn-sm btn-success me-1';
          completeBtn.textContent = 'Complete';
          completeBtn.onclick = () => updateTask(t.id, 'Completed');

          const pendingBtn = document.createElement('button');
          pendingBtn.className = 'btn btn-sm btn-warning me-1';
          pendingBtn.textContent = 'Pending';
          pendingBtn.onclick = () => updateTask(t.id, 'Pending');

          const deleteBtn = document.createElement('button');
          deleteBtn.className = 'btn btn-sm btn-danger';
          deleteBtn.textContent = 'Delete';
          deleteBtn.onclick = () => deleteTask(t.id);

          // show Complete only when not completed, show Pending when completed
          right.appendChild(t.status === 'Completed' ? pendingBtn : completeBtn);
          right.appendChild(deleteBtn);

          li.appendChild(left);
          li.appendChild(right);
          list.appendChild(li);
        });
      } catch (err) {
        console.error(err);
        alert('Failed to load tasks. Is the backend running?');
      }
    }

    // Add a task
    async function addTask() {
      const titleEl = document.getElementById('title');
      const descEl = document.getElementById('description');
      const title = titleEl.value.trim();
      const description = descEl.value.trim();
      if (!title) { alert('Enter a title'); return; }

      try {
        await fetch(API, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ title, description })
        });
        titleEl.value = '';
        descEl.value = '';
        fetchTasks();
      } catch (err) {
        console.error(err);
        alert('Failed to add task');
      }
    }

    // Update task status
    async function updateTask(id, status) {
      try {
        await fetch(`${API}/${id}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ status })
        });
        fetchTasks();
      } catch (err) {
        console.error(err);
        alert('Failed to update task');
      }
    }

    // Delete task
    async function deleteTask(id) {
      if (!confirm('Delete this task?')) return;
      try {
        await fetch(`${API}/${id}`, { method: 'DELETE' });
        fetchTasks();
      } catch (err) {
        console.error(err);
        alert('Failed to delete task');
      }
    }

    // small helper to avoid HTML injection
    function escapeHtml(text) {
      return text
        .replaceAll('&', '&amp;')
        .replaceAll('<', '&lt;')
        .replaceAll('>', '&gt;')
        .replaceAll('"', '&quot;')
        .replaceAll("'", '&#039;');
    }

    // Events
    document.getElementById('addBtn').addEventListener('click', addTask);
    document.addEventListener('DOMContentLoaded', fetchTasks);
  </script>
</body>
</html>
